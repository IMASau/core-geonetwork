<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog 
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:gnext="http://geonetwork-opensource.org/liquibase-extensions"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet author="craigj" id="r9129">
        <gnext:updateSetting path="system/platform/version" value="2.8.0"/> 
    </changeSet>
    
    <!-- Note: revision 9144 was included in 2.7.0 change r8750-8891 -->
    
    <changeSet author="craigj" id="r9210">
        <!-- Add subtype 'webdav' to any webdav harvesters which don't have this setting -->
        <customChange class="liquibase.gn.custom.change.AddSubtype"/>
    </changeSet>
    
    <changeSet author="craigj" id="r9224">
        <!-- Merge host, port and servlet harvester site settings into the host setting -->
        <customChange class="liquibase.gn.custom.change.ImplodeHost"/>
    </changeSet>
    
    <changeSet author="craigj" id="r9251-4e1dedf">
        <sqlFile path="v280/r9251-4e1dedf/loc-cat-default.sql"/>
        <sqlFile path="v280/r9251-4e1dedf/loc-fin-default.sql"/>
        <sqlFile path="v280/r9251-4e1dedf/loc-ita-default.sql"/>
    </changeSet>
    
    <changeSet author="craigj" id="dffecf1">
        <sqlFile path="v280/dffecf1/data.sql"/>
    </changeSet>
    
    <changeSet author="craigj" id="58d2763">
        <sqlFile path="v280/58d2763/data.sql"/>
    </changeSet>
    
    <changeSet author="craigj" id="5a8cccf">
        <sqlFile path="v280/5a8cccf/loc-ara-default.sql"/>
    </changeSet>
    
    <changeSet author="craigj" id="fb0e13a">
        <sqlFile path="v280/fb0e13a/migrate-db-postgis.sql"/>
    </changeSet>
    
    <changeSet author="craigj" id="a89e52a">
        <gnext:updateSetting path="system/requestedLanguage/only" value="prefer_locale"/> 
    </changeSet>
    
    <changeSet author="craigj" id="32898e2">
        <sqlFile path="v280/32898e2/loc-pol-default.sql"/>
    </changeSet>
    
    <changeSet author="craigj" id="c3a905f3">
        <gnext:updateSetting path="system/platform/subVersion" value="0"/> 
    </changeSet>
    
    <changeSet author="craigj" id="47664720-fccc-11e3-a3ac-0800200c9a66">
        <sql endDelimiter="#">
CREATE OR REPLACE FUNCTION create_gt_pk_metadata ()
 RETURNS void AS
$$ BEGIN
    IF NOT EXISTS (SELECT * FROM pg_catalog.pg_tables WHERE tablename  = 'gt_pk_metadata' AND schemaname = current_schema()) THEN
        CREATE TABLE gt_pk_metadata (
            table_schema VARCHAR(32) NOT NULL,
            table_name VARCHAR(256) NOT NULL,
            pk_column VARCHAR(32) NOT NULL,
            pk_column_idx INTEGER,
            pk_policy VARCHAR(32),
            pk_sequence VARCHAR(64),
            unique (table_schema, table_name, pk_column),
            check (pk_policy in ('sequence', 'assigned', 'autogenerated')));
    END IF;
END; $$
LANGUAGE 'plpgsql'#

SELECT create_gt_pk_metadata ()
        </sql>
    </changeSet>
    
</databaseChangeLog>
